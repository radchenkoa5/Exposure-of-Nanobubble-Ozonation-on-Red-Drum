---
title: "Path Analysis"
author: "Anna Radchenko"
date: "March 1, 2020"
output: html_document
---
```{r}
library(lavaan)
library(semPlot)
library(OpenMx)
library(tidyverse)
library(knitr)
library(kableExtra)
library(GGally)
library (caret)
```


```{r}
gill <- read.csv("~/Theses Pieces/Tank Pad Pilot Study/GillFakeDataSet.csv")
```

```{r}
training.samples <- gill$Gill.Score %>%    createDataPartition(p = 0.8, list = FALSE)
train.data <- data[training.samples, ]
test.data <- data[-training.samples, ]
```


```{r}
plot(Gill.Score ~ Treatment, data = gill)
```


```{r}
treatonly <- (lm(Gill.Score ~ Treatment, data = gill))
summary(treatonly)
shapiro.test(residuals(treatonly))
```


```{r}
model1 <- lm(Gill.Score ~ Treatment + Condition.Factor + Chla + DO + Max.DO + Salinity + pH + Temp + Secchi, data = gill)
shapiro.test(residuals(model1))
summary(model1)

```

```{r}
car::vif(model1)
```

```{r}
gill.na <- na.omit(gill)
```




```{r}
model <- '

Gill.Score ~ Treatment + DO + Max.DO + Salinity + pH + Temp + Chla + Condition.Factor

Chla ~~ Secchi + Ammonia + Height + Nitrite + Nitrate + Temp
Max.DO ~~ Treatment + Temp
Treatment ~~ Chla + pH + Temp + Salinity


'
```





```{r}
fit <- cfa(model, data = gill.na)
varTable(fit)
summary(fit)
```


```{r}
myNames <- lavNames(sem(model))
myData <- data[myNames]
myData <- myData[complete.cases(myData), ]
myCov <- cov(myData)
round(myCov, 2)
##check whether any correlations are perfect (ie. any colinearity)
myCor <- cov2cor(myCov)
noDiag <- myCor
diag(noDiag) <- 0
any(noDiag == 1)
## if not, check for multicollinearity (ie. is one variable a linear combination of 2+ variables?)
det(myCov) < 0
## or 
any(eigen(myCov)$values < 0)
```
```


